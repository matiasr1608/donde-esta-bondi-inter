import{$ as t}from"./all-52704ca9.js";import{l}from"./L.Control.Locate-8a6d4cfd.js";const w="backend.matiasrolando.com";var _={10:["2","222","402","404","405","407","409","427","456","494","4A","4AC","4AD","4D","4DR","600","76","CE1","D9","G","L14","L16","L29","L7"],13:["15A","15B","6A","6R6"],18:["1A","2A","700","701","703","704","705","706","707","708","709","710","711","712","714","724","747","748","750","751","752","757","7A","7E7R","7E8R","802","803","804","809","8A","8E7R","8E8R","DM1","P757","P758","P759","P760","P761","P768","P7H","XA1","XA2"],20:["1M1","1M12","1M6","1M7","2M1","2M7","2M8","505","522","524","526","538","546","582","D11","L24","L25","L38","MD3","ML1"],29:["2K"],32:["S5","S6","S7"],33:["A1","A10","A11","A12","A14","A16","A18","A5","A6","A9"],35:["10A","14A","14AB","14AR","T1","T14A","T2","T4N","T4R","T5","T6"],36:[],37:[],39:["Z1","Z2","Z3","Z4"],50:["100","102","103","104","105","109","110","111","112","113","115","116","117","121","124","125","127","128","130","137","141","142","143","144","145","147","148","149","150","151","155","156","157","158","163","169","174","175","180","181","183","185","186","187","188","191","192","195","199","21","214","227","230","268","276","60","62","64","C1","C2","C3","C4","C5","CE1","D10","D5","D8","DE1","DM1","E14","G10","G11","G3","G8","L1","L15","L2","L20","L22","L26","L28","L3","L35","L36","L39","L4","L41","L46","L5","L6","L9"],70:["11A","17","221","300","306","316","328","329","330","370","396","71","79","CE1","DM1","L12","L31","L33","U11C","XA1"],80:[]},i=null,s=null,n=null,I=new Array,y=null,r=!0;let u=null;var m=null,c=null;let f=[];t(document).ready(function(){var d=null;window.addEventListener("beforeinstallprompt",E,T);function E(e){d=e,document.getElementById("pwa_btn").removeAttribute("disabled")}function T(e){console.log("error: "+e)}t("#pwa_btn").click(()=>{d&&d.prompt()}),setTimeout(()=>{d||(document.getElementById("pwa_btn").removeAttribute("disabled"),t("#pwa_btn").attr("data-bs-toggle","modal"),t("#pwa_btn").attr("data-bs-target","#exampleModal"))},1e3),s=l.map("map").setView([-34.814733,-56.180452],9),l.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(s),l.control.locate({position:"topright",strings:{title:"Ubicarme."}}).addTo(s),n=l.featureGroup().addTo(s);function g(){t.ajax({url:`https://${w}/updateDB`,method:"get",contentType:"application/json",success:function(e){console.log(e)}})}g(),t("#search").click(async()=>{r?(h(),console.log("hola hola")):u||(h(),u=setTimeout(()=>{clearTimeout(u),u=null},2e3))});const h=()=>{t.ajax({url:`https://${w}/buses?codigoEmpresa=`+t("#empresa").val()+"&linea="+t("#linea").val(),method:"get",contentType:"application/json",success:e=>{C(e),console.log(e)}})};function C(e){t("#search").html("Actualizar"),i=e.data,i.forEach(o=>{o.geometry.coordinates.reverse()});let a=e.lastUpdateDB;console.log(a),i.length>0?(f=new Array,i.forEach(o=>{f.indexOf(o.properties.destinoDesc)===-1&&f.push(o.properties.destinoDesc)}),r&&B(),new Promise(function(o){v(),o()}),t("#alert_tiempo").empty(),Date.now()-e.lastUpdateDB>=2e4&&(t("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Las ubicaciones no están actualizadas, intente de nuevo en unos segundos.(diferencia '+(Date.now()-e.lastUpdateDB)/1e3+'segundos)<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),console.log("mas de 20 seg"),g(),t("#search").addClass("disabled"),t("#search").html("Espere"),setTimeout(function(){t("#search").removeClass("disabled"),t("#search").html("Actualizar")},5e3)),t(".tercero").removeAttr("hidden"),t("#select_company")[0].scrollIntoView()):t("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">No hay ubicaciones reportadas para su búsqueda, intente nuevamente.<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),r=!1}function B(){let e=0;t("#switch_destinations").empty(),f.forEach(a=>{e+=1,k(a,v,e)})}const k=(e,a,o)=>{t("#switch_destinations").append(`<div class= "form-check form-switch">
                <input class="form-check-input" type="checkbox" name="prueba" role="switch" value="${e}" id="flexSwitchCheck${o}" checked>
                <label class="form-check-label" for="flexSwitchCheck${e}">${e}</label>
            </div>`),t(`#flexSwitchCheck${o}`).click(()=>a())},v=()=>{var e=new Array;t(".form-check-input:checked").each(function(){e.push(t(this).val())});let a=i.filter(o=>e.includes(o.properties.destinoDesc));b(a,15)};function b(e,a){new Promise(function(o){s.removeLayer(n),n=l.featureGroup(),o()}).then(()=>{e.forEach(o=>{let D=null;c&&(D="disabled");const p=l.marker(o.geometry.coordinates);p.bindPopup(`<div style="display: flex; justify-content: space-between;"> <p class="mb-0 mt-0 fs-6 fw-bold"><b>${o.properties.linea} </b> </p>       <button class= "mt-0 mb-0 btn btn-outline-primary btn-sm fw-bold seguiBus" ${D}>Seguí tu bondi</button> </div>
                </br>Destino: ${o.properties.destinoDesc} </br>
                 Tipo: ${o.properties.sublinea}`).on("click",S),I.push(p),p.addTo(n),o.marker_id=n.getLayerId(p)}),n.addTo(s),y=null,y=n.getBounds(),e.length>1&&s.fitBounds(y),e.length==1&&s.setView(e[0].geometry.coordinates,a)})}t("#empresa").change(function(){r=!0;var e=t("#empresa").val();t(".segundo").removeAttr("disabled"),t("#linea").empty(),_[e].forEach(a=>{t("#linea").append("<option value="+a+">"+a+"</option>")})}),t("#linea").change(()=>{r=!0});const S=e=>{m=null,console.log(n.getLayerId(e.target)),m=i.filter(a=>a.marker_id==n.getLayerId(e.target)),e.target},L=e=>{e?(Date.now()-e.lastUpdateDB>=2e4&&g(),i=e.data,i.forEach(a=>{a.geometry.coordinates.reverse()}),b(i,s.getZoom())):(b(m,15),c=setInterval(()=>{M(m[0].properties.id)},7e3)),t("#alert_follow").empty().append('<div style="display: flex; justify-content: space-between;" class="alert alert-info fade show" role="alert"><p class="align-self-center mb-0 mt-0">Estás siguiendo a tu bondi (actualización automática).</p><button type="button" class="btn btn btn-outline-danger align-self-right" id="closeBtnFollow">Dejar de seguir</button> </div>'),t("#closeBtnFollow").click(()=>{t("#alert_follow").empty(),clearInterval(c),c=null,h()})};t(document).on("click",".seguiBus",function(e){c||L()});const M=e=>{t.ajax({url:`https://${w}/getBusbyID?ID=${e}`,method:"get",contentType:"application/json",success:a=>{L(a)}})};let A=[{codigo:"13",descripcion:"CASANOVA LIMITADA"},{codigo:"29",descripcion:"C.I.T.A."},{codigo:"10",descripcion:"C.O.E.T.C."},{codigo:"33",descripcion:"C.O. DEL ESTE"},{codigo:"20",descripcion:"C.O.M.E.S.A"},{codigo:"18",descripcion:"C.O.P.S.A."},{codigo:"50",descripcion:"C.U.T.C.S.A."},{codigo:"32",descripcion:"SATT"},{codigo:"35",descripcion:"TALA-PANDO-MONTEVIDEO"},{codigo:"70",descripcion:"U.C.O.T."},{codigo:"39",descripcion:"ZEBALLOS HERMANOS"}];for(let e in A)t("#empresa").append("<option value="+A[e].codigo+">"+A[e].descripcion+"</option>")});
