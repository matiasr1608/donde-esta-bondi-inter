"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkdonde_esta_bondi_inter"] = self["webpackChunkdonde_esta_bondi_inter"] || []).push([["src_index_js"],{

/***/ "./src/css/custom_index.css":
/*!**********************************!*\
  !*** ./src/css/custom_index.css ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://donde-esta-bondi-inter/./src/css/custom_index.css?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var bootstrap_dist_css_bootstrap_min_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bootstrap/dist/css/bootstrap.min.css */ \"./node_modules/bootstrap/dist/css/bootstrap.min.css\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ \"./node_modules/jquery/dist/jquery.js\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _css_custom_index_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./css/custom_index.css */ \"./src/css/custom_index.css\");\n/* harmony import */ var leaflet_dist_leaflet_css__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! leaflet/dist/leaflet.css */ \"./node_modules/leaflet/dist/leaflet.css\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var leaflet_locatecontrol_dist_L_Control_Locate_css__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! leaflet.locatecontrol/dist/L.Control.Locate.css */ \"./node_modules/leaflet.locatecontrol/dist/L.Control.Locate.css\");\n/* harmony import */ var leaflet_locatecontrol__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! leaflet.locatecontrol */ \"./node_modules/leaflet.locatecontrol/src/L.Control.Locate.js\");\n/* harmony import */ var leaflet_locatecontrol__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(leaflet_locatecontrol__WEBPACK_IMPORTED_MODULE_6__);\n// const { cssNumber } = require(\"jquery\");\nconst DENO_URL = 'backend.matiasrolando.com'\nvar lineas = { 10: ['2', '222', '402', '404', '405', '407', '409', '427', '456', '494', '4A', '4AC', '4AD', '4D', '4DR', '600', '76', 'CE1', 'D9', 'G', 'L14', 'L16', 'L29', 'L7'], 13: ['15A', '15B', '6A', '6R6'], 18: ['1A', '2A', '700', '701', '703', '704', '705', '706', '707', '708', '709', '710', '711', '712', '714', '724', '747', '748', '750', '751', '752', '757', '7A', '7E7R', '7E8R', '802', '803', '804', '809', '8A', '8E7R', '8E8R', 'DM1', 'P757', 'P758', 'P759', 'P760', 'P761', 'P768', 'P7H', 'XA1', 'XA2'], 20: ['1M1', '1M12', '1M6', '1M7', '2M1', '2M7', '2M8', '505', '522', '524', '526', '538', '546', '582', 'D11', 'L24', 'L25', 'L38', 'MD3', 'ML1'], 29: ['2K'], 32: ['S5', 'S6', 'S7'], 33: ['A1', 'A10', 'A11', 'A12', 'A14', 'A16', 'A18', 'A5', 'A6', 'A9'], 35: ['10A', '14A', '14AB', '14AR', 'T1', 'T14A', 'T2', 'T4N', 'T4R', 'T5', 'T6'], 36: [], 37: [], 39: ['Z1', 'Z2', 'Z3', 'Z4'], 50: ['100', '102', '103', '104', '105', '109', '110', '111', '112', '113', '115', '116', '117', '121', '124', '125', '127', '128', '130', '137', '141', '142', '143', '144', '145', '147', '148', '149', '150', '151', '155', '156', '157', '158', '163', '169', '174', '175', '180', '181', '183', '185', '186', '187', '188', '191', '192', '195', '199', '21', '214', '227', '230', '268', '276', '60', '62', '64', 'C1', 'C2', 'C3', 'C4', 'C5', 'CE1', 'D10', 'D5', 'D8', 'DE1', 'DM1', 'E14', 'G10', 'G11', 'G3', 'G8', 'L1', 'L15', 'L2', 'L20', 'L22', 'L26', 'L28', 'L3', 'L35', 'L36', 'L39', 'L4', 'L41', 'L46', 'L5', 'L6', 'L9'], 70: ['11A', '17', '221', '300', '306', '316', '328', '329', '330', '370', '396', '71', '79', 'CE1', 'DM1', 'L12', 'L31', 'L33', 'U11C', 'XA1'], 80: [] }\nvar buses = null;\nvar map = null;\nvar groupMarkers = null;\nvar markers = new Array();\nvar bounds = null;\nvar firstTime = true;  // to ckeck if it is the first time that searches or is it an update \nlet timeOut = null;\nvar selectedBus = null;\nvar timerfollowBus = null;\nvar selectedMarker = null;\nvar destinos = new Array();\n\n\n\n\n// import \"./all.js\"\n\n\n\n\n\n\n\n\n\njquery__WEBPACK_IMPORTED_MODULE_1___default()(document).ready(function () {\n\n    //service woerker\n    if (\"serviceWorker\" in navigator) {\n        window.addEventListener(\"load\", function () {\n            navigator.serviceWorker\n                .register(\"./serviceWorker.js\")\n                .then(res => console.log(\"service worker registered\"))\n                .catch(err => console.log(\"service worker not registered\", err))\n        })\n    }\n    // navigator.serviceWorker.ready.then((registration) => {\n    //     registration.update();\n    //   });\n    // PWA BUTTON\n    var beforeInstallPrompt = null;   //variable to save the event \n\n    window.addEventListener(\"beforeinstallprompt\", eventHandler, errorHandler);\n\n    function eventHandler(event) {\n        beforeInstallPrompt = event;\n        document.getElementById(\"pwa_btn\").removeAttribute(\"disabled\");\n    }\n\n    function errorHandler(event) {\n        console.log(\"error: \" + event);\n    }\n\n    jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#pwa_btn\").click(() => {\n        if (beforeInstallPrompt) { beforeInstallPrompt.prompt() };\n    })\n\n    //button to show modal if there isnt an event\n    setTimeout(() => {\n        if (!beforeInstallPrompt) {\n            document.getElementById(\"pwa_btn\").removeAttribute(\"disabled\");\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#pwa_btn\").attr('data-bs-toggle', \"modal\")\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#pwa_btn\").attr(\"data-bs-target\", \"#exampleModal\")\n\n        }\n    }, 1000)\n\n\n\n    // MAPA\n    map = leaflet__WEBPACK_IMPORTED_MODULE_4__.map('map').setView([-34.814733, -56.180452], 9);\n    leaflet__WEBPACK_IMPORTED_MODULE_4__.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 19,\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n    }).addTo(map);\n    leaflet__WEBPACK_IMPORTED_MODULE_4__.control.locate({\n        position: \"bottomright\",\n        strings: {\n            title: \"Ubicarme.\"\n        }\n    }).addTo(map); // add button to locate\n    //////////\n    groupMarkers = leaflet__WEBPACK_IMPORTED_MODULE_4__.featureGroup().addTo(map);\n\n    // update de db\n    function updateDB() {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default().ajax(\n            {\n                url: `https://${DENO_URL}/updateDB`,\n                method: \"get\",\n                contentType: \"application/json\",\n\n\n                // data:JSON.stringify({\"subsistema\":\"-1\",\"empresa\":\"-1\"}),\n                success: function (response) {\n                    console.log(response);\n                }\n            }\n        )\n    }\n    updateDB();\n\n\n    //////alert\n\n    // SEARCH BUTTON\n    jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").click(async () => {\n        if (firstTime) {\n            ajaxSearchBuses()\n            console.log(\"hola hola\")\n        } else {\n            if (!timeOut) {\n                ajaxSearchBuses()\n                timeOut = setTimeout(() => { clearTimeout(timeOut); timeOut = null }, 2000)\n            }\n        }\n    }\n    )\n    const ajaxSearchBuses = () => {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default().ajax(\n            {\n                url: `https://${DENO_URL}/buses?codigoEmpresa=` + jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#empresa\").val() + \"&linea=\" + jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#linea\").val(),\n                method: \"get\",\n                contentType: \"application/json\",\n                // data:JSON.stringify({\"subsistema\":\"-1\",\"empresa\":\"-1\"}),\n                success: (response) => {\n                    showResponseBuses(response)\n                    console.log(response)\n                }\n            }\n        )\n    }\n    //array for the markers of the map\n    // var destinos = [];\n    function showResponseBuses(response) {\n        //console.log(response)\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").html(\"Actualizar\")\n        buses = response.data;\n        buses.forEach(bus => { bus.geometry.coordinates.reverse() })\n        var last = response.lastUpdateDB;\n        console.log(last)\n        if (buses.length > 0) {\n            destinos = new Array(); // to save later destinations to choose from\n            buses.forEach(bus => {\n                if (destinos.indexOf(bus.properties.destinoDesc) === -1) { destinos.push(bus.properties.destinoDesc) };//make a list of the destinations so u can show them as button to select\n            });\n            if (firstTime) {\n                adddestinatiosHtml();\n            }\n            new Promise(function (resolve) {\n                filterBusesByDest();\n                resolve()\n            })\n\n\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#alert_tiempo\").empty();\n            if (((Date.now() - response.lastUpdateDB) >= 20000)) {\n                jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#alert_tiempo\").empty()\n                    .append('<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">Las ubicaciones no están actualizadas, intente de nuevo en unos segundos.(diferencia ' + (Date.now() - response.lastUpdateDB) / 1000 + 'segundos)<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button> </div>')\n                console.log(\"mas de 20 seg\");\n                updateDB();\n                jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").addClass('disabled');\n                jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").html(\"Espere\")\n                setTimeout(function () { jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").removeClass('disabled'); jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#search\").html(\"Actualizar\") }, 5000)\n\n            }\n            // $(\".tercero\").removeClass(\"invisible\")\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\".tercero\").removeAttr(\"hidden\")\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#select_company\")[0].scrollIntoView()\n\n        } else {\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#alert_tiempo\").empty()\n\n                .append('<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">No hay ubicaciones reportadas para su búsqueda, intente nuevamente.<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button> </div>')\n\n        }\n        firstTime = false\n\n    }\n\n\n    function adddestinatiosHtml() {  //adds the destinations so u can toggle betwen them\n        var i = 0\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#switch_destinations\").empty();\n        destinos.forEach((dest) => {\n            i += 1;\n            createFormChe(dest, filterBusesByDest, i)\n        })\n    }\n\n    const createFormChe = (dest, handler, i) => {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#switch_destinations\").append(\n            `<div class= \"form-check form-switch\">\n                <input class=\"form-check-input\" type=\"checkbox\" name=\"prueba\" role=\"switch\" value=\"${dest}\" id=\"flexSwitchCheck${i}\" checked>\n                <label class=\"form-check-label\" for=\"flexSwitchCheck${dest}\">${dest}</label>\n            </div>`\n        );\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#flexSwitchCheck${i}`).click(() => handler())\n\n    }\n\n\n    const filterBusesByDest = () => {  //everytime a check is clicked updates the buses on the map\n\n        var destChecked = new Array();\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\".form-check-input:checked\").each(function () {\n            destChecked.push((jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val()))\n        })\n        const buesesChecked = buses.filter(bus => destChecked.includes(bus.properties.destinoDesc)) //\n        showBuses(buesesChecked, 15);\n\n    };\n\n\n    function showBuses(busess, zoom) { //add buses to the map recived as an array\n        //remove markers if there are any'\n        new Promise(function (resolve) {\n            map.removeLayer(groupMarkers)\n            groupMarkers = leaflet__WEBPACK_IMPORTED_MODULE_4__.featureGroup();\n            resolve();\n        }).then(() => {\n            busess.forEach((bus) => {\n                let btn_attr = null\n                if (timerfollowBus) { // if following a bus, the button of the pop up to follow a bus deactivated\n                    btn_attr = \"disabled\"\n                }\n                const marker = leaflet__WEBPACK_IMPORTED_MODULE_4__.marker(bus.geometry.coordinates) //removed reverse()\n                marker.bindPopup(`<div style=\"display: flex; justify-content: space-between;\"> <p class=\"mb-0 mt-0 fs-6 fw-bold\"><b>${bus.properties.linea} </b> </p>       <button class= \"mt-0 mb-0 btn btn-outline-primary btn-sm fw-bold seguiBus\" ${btn_attr}>Seguí tu bondi</button> </div>\n                </br>Destino: ${bus.properties.destinoDesc} </br>\n                 Tipo: ${bus.properties.sublinea}`)\n                    .on(\"click\", saveSelectedBus)\n                // marker.addTo(map)\n                markers.push(marker)\n                marker.addTo(groupMarkers)\n                bus.marker_id = groupMarkers.getLayerId(marker)   // vinculate each bus to a marker in the map\n            })\n            groupMarkers.addTo(map);\n            //new Promise((resolve) => {\n            bounds = null\n            bounds = groupMarkers.getBounds();\n            //   resolve()\n            //}).then(() => {\n\n            if (busess.length > 1) {\n                map.fitBounds(bounds)\n            } else {\n            }\n            if (busess.length == 1) {\n                map.setView(busess[0].geometry.coordinates, zoom)\n            }\n            // }\n            //)\n            //$('.leaflet-marker-icon').on('click',(e)=>{saveSelectedBus(e)});\n\n        })\n    }\n\n\n\n    jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#empresa\").change(function () {\n        firstTime = true\n        var empresa = jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#empresa\").val();\n        // empresa = document.getElementById(\"empresa\").value;\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\".segundo\").removeAttr(\"disabled\");\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#linea\").empty()\n        lineas[empresa].forEach(i => {\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#linea\").append('<option value=' + i + '>' + i + '</option>')\n        });\n    })\n    jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#linea\").change(() => {\n        firstTime = true\n    }\n    )\n    const saveSelectedBus = (e) => {   // saves the bus vinculated to the marker clicked\n        selectedBus = null\n        console.log(groupMarkers.getLayerId(e.target))\n        //console.log(e)\n        //console.log(groupMarkers.getLayerId(e.target))\n        selectedBus = buses.filter(bus => bus.marker_id == groupMarkers.getLayerId(e.target))\n        selectedMarker = e.target\n    }\n\n    const followSelectedBus = (response) => {   // centers the map on the selected bus\n        if (response) {\n            if (((Date.now() - response.lastUpdateDB) >= 20000)) {\n                updateDB();\n            }\n            buses = response.data\n            buses.forEach(bus => { bus.geometry.coordinates.reverse() })\n            showBuses(buses, map.getZoom())\n            //var mapZoom = null;\n            //mapZoom = map.getZoom()\n            //map.setView(response.data[0].geometry.coordinates.reverse(), 9)\n\n\n            //console.log(mapZoom)\n        } else {\n            showBuses(selectedBus, 15)\n            // map.setView(selectedBus[0].geometry.coordinates, 15)\n            timerfollowBus = setInterval(() => {\n                getBusByID(selectedBus[0].properties.id)\n            }, 7000)\n        }\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#alert_follow\").empty()\n            .append('<div style=\"display: flex; justify-content: space-between;\" class=\"alert alert-info fade show\" role=\"alert\"><p class=\"align-self-center mb-0 mt-0\">Estás siguiendo a tu bondi (actualización automática).</p><button type=\"button\" class=\"btn btn btn-outline-danger align-self-right\" id=\"closeBtnFollow\">Dejar de seguir</button> </div>')\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#closeBtnFollow\").click(() => {\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"#alert_follow\").empty()\n            clearInterval(timerfollowBus)\n            timerfollowBus = null\n            ajaxSearchBuses()\n        })\n    }\n\n    jquery__WEBPACK_IMPORTED_MODULE_1___default()(document).on(\"click\", \".seguiBus\", function (e) {   //adds the events fot p tag that dosnt yet exists\n        if (!timerfollowBus) {\n            followSelectedBus();  //only follow bus if there is a timer \n        }\n        // selectedMarker._popup.setContent((`<div style=\"display: flex; justify-content: space-between;\"> <p class=\"mb-0 mt-0 fs-6 fw-bold\"><b>${selectedBus[0].properties.linea} </b> </p>       <button class= \"mt-0 mb-0 btn btn-outline-primary btn-sm fw-bold seguiBus\" disabled>Siguiendo.</button> </div>\n        // </br>Destino: ${selectedBus[0].properties.destinoDesc} </br>\n        //  Tipo: ${selectedBus[0].properties.sublinea}`))\n    });\n\n\n\n\n\n    const getBusByID = (ID) => {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default().ajax(\n            {\n                url: `https://${DENO_URL}/getBusbyID?ID=${ID}`,\n                method: \"get\",\n                contentType: \"application/json\",\n                // data:JSON.stringify({\"subsistema\":\"-1\",\"empresa\":\"-1\"}),\n                success: (response) => {\n                    followSelectedBus(response)\n                }\n            }\n        )\n    }\n\n    let empresas = [\n        {\n            codigo: '13',\n            descripcion: 'CASANOVA LIMITADA'\n        },\n        {\n            codigo: '29',\n            descripcion: 'C.I.T.A.'\n        },\n        {\n            codigo: '10',\n            descripcion: 'C.O.E.T.C.'\n        },\n        {\n            codigo: '33',\n            descripcion: 'C.O. DEL ESTE'\n        },\n        {\n            codigo: '20',\n            descripcion: 'C.O.M.E.S.A'\n        },\n        {\n            codigo: '18',\n            descripcion: 'C.O.P.S.A.'\n        },\n\n        {\n            codigo: '50',\n            descripcion: 'C.U.T.C.S.A.'\n        },\n        {\n            codigo: '32',\n            descripcion: 'SATT'\n        },\n\n        {\n            codigo: '35',\n            descripcion: 'TALA-PANDO-MONTEVIDEO'\n        },\n        {\n            codigo: '70',\n            descripcion: 'U.C.O.T.'\n        },\n        {\n            codigo: '39',\n            descripcion: 'ZEBALLOS HERMANOS'\n        },\n\n\n\n    ];\n\n    for (let i in empresas) {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()('#empresa').append(('<option value=' + empresas[i].codigo + '>' + empresas[i].descripcion + '</option>'))\n    }\n\n\n\n\n})\n\n\n//# sourceURL=webpack://donde-esta-bondi-inter/./src/index.js?");

/***/ })

}]);