import{$ as n,M as Ae}from"./for_all-daa5477a.js";import{l as A}from"./L.Control.Locate-034beaad.js";const Se="data:image/png;base64,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fFvbqMe3V6lP/wULofNwWi7YuXZNUKHIK+SF9MbyisOeTl3Zv650wP19vG8vMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMURvF5dXHJZgMs7+daU97j+XEGKwEGKwEGKwEGKwEGKwEGKwEGKwEGKwEGL8H6PEFvcfQRp6AAAAAElFTkSuQmCC",Le=""+new URL("BusIcon-8a605cbb.png",import.meta.url).href;try{self["workbox:window:6.5.3"]&&_()}catch{}function $(o,l){return new Promise(function(i){var d=new MessageChannel;d.port1.onmessage=function(p){i(p.data)},o.postMessage(l,[d.port2])})}function ke(o,l){for(var i=0;i<l.length;i++){var d=l[i];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}function le(o,l){(l==null||l>o.length)&&(l=o.length);for(var i=0,d=new Array(l);i<l;i++)d[i]=o[i];return d}function Te(o,l){var i;if(typeof Symbol>"u"||o[Symbol.iterator]==null){if(Array.isArray(o)||(i=function(p,u){if(p){if(typeof p=="string")return le(p,u);var f=Object.prototype.toString.call(p).slice(8,-1);return f==="Object"&&p.constructor&&(f=p.constructor.name),f==="Map"||f==="Set"?Array.from(p):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?le(p,u):void 0}}(o))||l&&o&&typeof o.length=="number"){i&&(o=i);var d=0;return function(){return d>=o.length?{done:!0}:{done:!1,value:o[d++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(i=o[Symbol.iterator]()).next.bind(i)}try{self["workbox:core:6.5.3"]&&_()}catch{}var Z=function(){var o=this;this.promise=new Promise(function(l,i){o.resolve=l,o.reject=i})};function Y(o,l){var i=location.href;return new URL(o,i).href===new URL(l,i).href}var C=function(o,l){this.type=o,Object.assign(this,l)};function U(o,l,i){return i?l?l(o):o:(o&&o.then||(o=Promise.resolve(o)),l?o.then(l):o)}function Ce(){}var Re={type:"SKIP_WAITING"};function ce(o,l){if(!l)return o&&o.then?o.then(Ce):Promise.resolve()}var Pe=function(o){var l,i;function d(h,m){var r,a;return m===void 0&&(m={}),(r=o.call(this)||this).nn={},r.tn=0,r.rn=new Z,r.en=new Z,r.on=new Z,r.un=0,r.an=new Set,r.cn=function(){var g=r.fn,s=g.installing;r.tn>0||!Y(s.scriptURL,r.sn.toString())||performance.now()>r.un+6e4?(r.vn=s,g.removeEventListener("updatefound",r.cn)):(r.hn=s,r.an.add(s),r.rn.resolve(s)),++r.tn,s.addEventListener("statechange",r.ln)},r.ln=function(g){var s=r.fn,y=g.target,L=y.state,R=y===r.vn,P={sw:y,isExternal:R,originalEvent:g};!R&&r.mn&&(P.isUpdate=!0),r.dispatchEvent(new C(L,P)),L==="installed"?r.wn=self.setTimeout(function(){L==="installed"&&s.waiting===y&&r.dispatchEvent(new C("waiting",P))},200):L==="activating"&&(clearTimeout(r.wn),R||r.en.resolve(y))},r.dn=function(g){var s=r.hn,y=s!==navigator.serviceWorker.controller;r.dispatchEvent(new C("controlling",{isExternal:y,originalEvent:g,sw:s,isUpdate:r.mn})),y||r.on.resolve(s)},r.gn=(a=function(g){var s=g.data,y=g.ports,L=g.source;return U(r.getSW(),function(){r.an.has(L)&&r.dispatchEvent(new C("message",{data:s,originalEvent:g,ports:y,sw:L}))})},function(){for(var g=[],s=0;s<arguments.length;s++)g[s]=arguments[s];try{return Promise.resolve(a.apply(this,g))}catch(y){return Promise.reject(y)}}),r.sn=h,r.nn=m,navigator.serviceWorker.addEventListener("message",r.gn),r}i=o,(l=d).prototype=Object.create(i.prototype),l.prototype.constructor=l,l.__proto__=i;var p,u,f=d.prototype;return f.register=function(h){var m=(h===void 0?{}:h).immediate,r=m!==void 0&&m;try{var a=this;return function(g,s){var y=g();return y&&y.then?y.then(s):s(y)}(function(){if(!r&&document.readyState!=="complete")return ce(new Promise(function(g){return window.addEventListener("load",g)}))},function(){return a.mn=!!navigator.serviceWorker.controller,a.yn=a.pn(),U(a.bn(),function(g){a.fn=g,a.yn&&(a.hn=a.yn,a.en.resolve(a.yn),a.on.resolve(a.yn),a.yn.addEventListener("statechange",a.ln,{once:!0}));var s=a.fn.waiting;return s&&Y(s.scriptURL,a.sn.toString())&&(a.hn=s,Promise.resolve().then(function(){a.dispatchEvent(new C("waiting",{sw:s,wasWaitingBeforeRegister:!0}))}).then(function(){})),a.hn&&(a.rn.resolve(a.hn),a.an.add(a.hn)),a.fn.addEventListener("updatefound",a.cn),navigator.serviceWorker.addEventListener("controllerchange",a.dn),a.fn})})}catch(g){return Promise.reject(g)}},f.update=function(){try{return this.fn?ce(this.fn.update()):void 0}catch(h){return Promise.reject(h)}},f.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},f.messageSW=function(h){try{return U(this.getSW(),function(m){return $(m,h)})}catch(m){return Promise.reject(m)}},f.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&$(this.fn.waiting,Re)},f.pn=function(){var h=navigator.serviceWorker.controller;return h&&Y(h.scriptURL,this.sn.toString())?h:void 0},f.bn=function(){try{var h=this;return function(m,r){try{var a=m()}catch(g){return r(g)}return a&&a.then?a.then(void 0,r):a}(function(){return U(navigator.serviceWorker.register(h.sn,h.nn),function(m){return h.un=performance.now(),m})},function(m){throw m})}catch(m){return Promise.reject(m)}},p=d,(u=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&ke(p.prototype,u),d}(function(){function o(){this.Pn=new Map}var l=o.prototype;return l.addEventListener=function(i,d){this.Sn(i).add(d)},l.removeEventListener=function(i,d){this.Sn(i).delete(d)},l.dispatchEvent=function(i){i.target=this;for(var d,p=Te(this.Sn(i.type));!(d=p()).done;)(0,d.value)(i)},l.Sn=function(i){return this.Pn.has(i)||this.Pn.set(i,new Set),this.Pn.get(i)},o}());const Be=Object.freeze(Object.defineProperty({__proto__:null,Workbox:Pe,WorkboxEvent:C,messageSW:$},Symbol.toStringTag,{value:"Module"})),Oe="modulepreload",De=function(o,l){return new URL(o,l).href},de={},xe=function(l,i,d){if(!i||i.length===0)return l();const p=document.getElementsByTagName("link");return Promise.all(i.map(u=>{if(u=De(u,d),u in de)return;de[u]=!0;const f=u.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(!!d)for(let a=p.length-1;a>=0;a--){const g=p[a];if(g.href===u&&(!f||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${h}`))return;const r=document.createElement("link");if(r.rel=f?"stylesheet":Oe,f||(r.as="script",r.crossOrigin=""),r.href=u,document.head.appendChild(r),f)return new Promise((a,g)=>{r.addEventListener("load",a),r.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>l())};function We(o={}){const{immediate:l=!1,onNeedRefresh:i,onOfflineReady:d,onRegistered:p,onRegisteredSW:u,onRegisterError:f}=o;let h,m;const r=async(g=!0)=>{await m};async function a(){if("serviceWorker"in navigator){const{Workbox:g}=await xe(()=>Promise.resolve().then(()=>Be),void 0,import.meta.url);h=new g("./serviceWorker.js",{scope:"/",type:"classic"}),h.addEventListener("activated",s=>{(s.isUpdate||s.isExternal)&&window.location.reload()}),h.addEventListener("installed",s=>{s.isUpdate||d==null||d()}),h.register({immediate:l}).then(s=>{u?u("./serviceWorker.js",s):p==null||p(s)}).catch(s=>{f==null||f(s)})}}return m=a(),r}const G="https://backend.matiasrolando.com";var O={41:["R1","R2","R10","R11","R12","R14","R15","R16","R17","R20","R24","R25"],10:["2","D222","222","402","404","405","407","409","427","456","494","4A","4AC","4AD","4D","48D","4DR","5D","600","76","CE1","D9","G","L13","L14","L16","L29","L7"],13:["15A","15B","6A","6R6"],18:["1A","2A","700","701","702","702R","703","704","705","706","707","708","709","710","711","712","714","724","747","748","750","751","752","757","7A","7E7R","7E8R","7E8D","7H","802","803","804","805","806","807","808","809","888","8A","8E7R","8E8R","DM1","P757","P758","P759","P760","P761","P768","P7H","XA1","XA2"],20:["1M11","1M1","1M2","1M3","1M4","1M5","1M6","1M7","1M12","1M13","1M14","1M15","1M16","1M6","1M7","2M1","2M7","2M8","505","522","524","526","538","546","582","D11","L24","L25","L38","MD3","ML1"],29:["2K"],32:["S5","S6","S7"],33:["A1","A10","A11","A12","A14","A16","A18","A5","A6","A9"],35:["10A","14A","14AB","14AR","T1","T14A","T2","T4N","T4R","T5","T6"],36:[],37:[],39:["Z1","Z2","Z3","Z4","Z6"],50:["100","102","103","103SD","104","105","109","110","111","112","113","115","116","117","121","124","124 SD","125","127","128","130","137","141","142","143","144","145","147","148","149","150","151","155","156","157","158","163","169","169 SD","174","175","180","181","183","185","186","187","188","191","192","195","199","21","214","227","230","230D","268","276","60","60 SD","62","64","C1","C2","C3","C4","C5","CE1","D10","D5","D8","DE1","DM1","E14","G10","G11","G3","G8","L1","L112","L15","L17","L18","L19","L2","L20","L22","L23","L26","L27","L28","L3","L30","L31","L34","L35","L36","L39","L4","L41","L46","L5","L6","L9"],70:["6B","11A","17","221","300","306","316","328","329","330","370","396","71","79","CE1","DM1","UAM1","LM13","L12","L31","L32","L33","PB","U11C","U11S","U11T","8SR","XA1"],80:[]},k=null,S=null,N=null,Ue=new Array,z=null,T=!0;let F=null;var K=null,D=null;let j=[],q=null;We({reloadOnUpdate:!0,immediate:!0});n(document).ready(function(){setTimeout(()=>{console.log("enrtró"),navigator.serviceWorker.getRegistration().then(function(e){e.waiting&&confirm("Actualización disponible, ¿Desea actualizar la página?")&&e.waiting.postMessage({type:"SKIP_WAITING"})}),navigator.serviceWorker.addEventListener("controllerchange",function(){window.location.reload()})},1e4);var o=null;window.addEventListener("beforeinstallprompt",l,d);function l(e){o=e,document.getElementById("pwa_btn").removeAttribute("disabled"),document.getElementById("pwa_btn2").removeAttribute("disabled")}function i(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":/Windows/i.test(e)?"Windows":/Macintosh|MacIntel|MacPPC|Mac68K/i.test(e)?"Mac":/Linux/i.test(e)?"Linux":"nosesabe"}window.addEventListener("appinstalled",()=>{let e="installed_app_from_"+i();gtag("event",e)});function d(e){console.log("error: "+e)}n("#pwa_btn").click(()=>{o&&o.prompt()}),n("#pwa_btn2").on("click",()=>{o&&(o.prompt(),gtag("event","install_promt_from_modal"))}),setTimeout(()=>{o||(document.getElementById("pwa_btn").removeAttribute("disabled"),n("#pwa_btn").attr("data-bs-toggle","modal"),n("#pwa_btn").attr("data-bs-target","#exampleModal"),document.getElementById("pwa_btn2").removeAttribute("disabled"),n("#pwa_btn2").attr("data-bs-toggle","modal"),n("#pwa_btn2").attr("data-bs-target","#exampleModal"))},1e3),window.mapita=A.map("map").setView([-34.814733,-56.180452],9).on("moveend",e=>{ge()}),A.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(window.mapita),A.control.locate({position:"topright",strings:{title:"Ubicarme."}}).addTo(window.mapita),S=A.featureGroup().addTo(window.mapita);function p(){n.ajax({url:`${G}/updateDB`,method:"get",contentType:"application/json",success:function(e){console.log(e)}})}p();const u=100,f=e=>Math.ceil(e*u)/u,h=e=>Math.floor(e*u)/u,m=(e,t)=>{const c=h(e),M=f(t),v=[];for(let b=c;b<=M;b+=1/u)v.push(b);return v};let r=0,a=new Map;const g=window.localStorage.getItem("tileMap2");let s=null;g===null?s=new Map:s=new Map(JSON.parse(g));const y=e=>{r+=1;let t=r;const c=m(e._southWest.lat,e._northEast.lat),M=m(e._southWest.lng,e._northEast.lng);let v=new Array;for(const w of c)for(const I of M)v.push({lat:w,long:I});a.size>0&&a.forEach((w,I)=>{if(!v.some(V=>JSON.stringify(V)===I)){//!arrayTilesSeen.some(obj => JSON.stringify(obj) === JSON.stringify(key))
ee(w),a.delete(I)}});let b=new Array;v.forEach(w=>{if(!a.has(JSON.stringify(w))){let I=P(w).then(V=>{if(t!=r)throw"se resolvió tarde";if(Array.isArray(V)){let W=L(V);return a.set(JSON.stringify(w),W),{tile:w,data:V}}else return a.set(JSON.stringify(w),[]),{tile:w,data:[]}});b.push(I)}}),Promise.allSettled(b).then(w=>{w.forEach(I=>{I.status=="fulfilled"&&s.set(JSON.stringify(I.value.tile),I.value.data)}),localStorage.setItem("tileMap2",JSON.stringify(Array.from(s.entries())))})},L=e=>{if(Array.isArray(e))return N=A.layerGroup(),e.forEach(t=>{const c=A.marker(t.geometry.coordinates,{icon:ue});var M=n("<div>",{class:"overflow-auto",style:"max-height: 15rem; max-width: 10rem"});M.append('<p class="mb-0 mt-0 fs-6 fw-bold">Seleccioná la linea a buscar:  </p> </br> ');var v=n("<div>");t.properties.lineas.split("-").forEach(b=>{var w=n("<button>",{id:"button"+b,type:"button",class:"btn btn-outline-primary btn-sm",style:"width:4rem"}).on("click",I=>{R(I)}).append(b);v.append(w)}),M.append(v),c.bindPopup(M[0]),c.addTo(N)}),N.addTo(window.mapita),N._leaflet_id},R=e=>{T=!0;let t=null;for(let c in O)O[c].indexOf(e.currentTarget.innerText)!==-1&&(t=c);B(t,e.currentTarget.innerText),console.log(t),te(e.currentTarget.innerText,t),gtag("event","searched_bus_by_stop",{empresa:t,linea:e.currentTarget.innerText})},P=async e=>{if(s.has(JSON.stringify(e))){let t=s.get(JSON.stringify(e));return new Promise(c=>{c(t)})}else{let t=[e.long+1/u,e.lat],c=[e.long,e.lat+1/u],M=String(t).replace(/\[|\]/g,""),v=String(c).replace(/\[|\]/g,"");return new Promise(b=>{n.ajax({url:`${G}/getStops?btmLeft=`+M+"&upperRight="+v,method:"get",contentType:"application/json",success:w=>{var I=w.data;Array.isArray(I)&&I.forEach(V=>{V.geometry.coordinates=V.geometry.coordinates.reverse()}),s.set(JSON.stringify(e),I),b(I)}})})}},ee=e=>{var t=window.mapita._layers[e];t&&window.mapita.removeLayer(t)},te=(e,t)=>{n("#empresa").val(t),n(".segundo").removeAttr("disabled"),n("#linea").empty(),n("#linea").append("<option value="+e+">"+e+"</option>")},ge=()=>{window.mapita.getZoom()>=15?y(window.mapita.getBounds()):a.forEach((e,t)=>{ee(e),a.delete(t)})};var ue=A.icon({iconUrl:Se,iconSize:[15,39],iconAnchor:[7,39],popupAnchor:[0,-39]}),pe=A.icon({iconUrl:Le,iconSize:[25,55],iconAnchor:[12.5,55],popupAnchor:[0,-39]});n("#search").click(async()=>{n("#search").html("Cargando..."),T?(B(n("#empresa").val(),n("#linea").val()),gtag("event","searched_bus",{empresa:n("#empresa").val(),linea:n("#linea").val()})):F||(B(n("#empresa").val(),n("#linea").val()),F=setTimeout(()=>{clearTimeout(F),F=null},2e3))});const B=(e,t)=>{n.ajax({url:`${G}/buses?codigoEmpresa=`+e+"&linea="+t,method:"get",contentType:"application/json",success:c=>{fe(c),console.log(c)}})},ne=(e,t)=>{const M=e.getBoundingClientRect().top-t;window.scrollTo({top:M,behavior:"smooth"})};function fe(e){if(n("#search").html("Actualizar"),k=e.data,k.forEach(t=>{t.geometry.coordinates.reverse()}),e.lastUpdateDB,k.length>0){if(j=new Array,q=new Array,k.forEach(t=>{j.indexOf(t.properties.destinoDesc)===-1&&j.push(t.properties.destinoDesc),q.indexOf(t.properties.sublinea)===-1&&q.push(t.properties.sublinea)}),T&&(he(),me()),new Promise(function(t){X(),t()}),n("#alert_tiempo").empty(),Date.now()-e.lastUpdateDB>=25e3){if(n("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Las ubicaciones no están actualizadas, intente actualizar nuevamente en unos segundos. (diferencia '+(Date.now()-e.lastUpdateDB)/1e3+'segundos)<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),console.log("mas de 20 seg"),p(),n("#search").addClass("disabled"),n("#search").html("Espere"),setTimeout(function(){n("#search").removeClass("disabled"),n("#search").html("Actualizar")},5e3),n(window).width()<992){const t=n("#select_company");ne(t,50)}}else n(window).width()<992&&setTimeout(()=>{const t=n("#map_bar")[0];ne(t,50)},150);n(".tercero").show()}else n("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">No hay ubicaciones reportadas para su búsqueda, intente nuevamente.<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),n("#search").html("Buscar"),H();T=!1}n("#separar_checkbox").on("click",()=>{n("#div_tipos").toggle()});const H=()=>{window.mapita.removeLayer(S),S=A.featureGroup(),n(".tercero").hide()};function he(){let e=0;n("#switch_destinations").empty(),j.forEach(t=>{e+=1,ve(t,X,e)})}const me=()=>{let e=0;n("#switch_tipos").empty(),q.forEach(t=>{e+=1,Me(t,X,e)})},ve=(e,t,c)=>{n("#switch_destinations").append(`<div class= "form-check form-switch">
                <input class="form-check-input" type="checkbox" name="check_destino" role="switch" value="${e}" id="flexSwitchDest${c}" checked>
                <label class="form-check-label" for="flexSwitchCheck${e}">${e}</label>
            </div>`),n(`#flexSwitchDest${c}`).click(()=>t())},Me=(e,t,c)=>{n("#switch_tipos").append(`<div class= "form-check form-switch">
                <input class="form-check-input check-destinos" type="checkbox" name="check_tipo" role="switch" value="${e}" id="flexSwitchType${c}" checked>
                <label class="form-check-label" for="flexSwitchCheck${e}">${e}</label>
            </div>`),n(`#flexSwitchType${c}`).click(()=>t())},X=()=>{var e=new Array,t=new Array;n("input:checkbox[name=check_destino]:checked").each(function(){e.push(n(this).val())}),n("input:checkbox[name=check_tipo]:checked").each(function(){t.push(n(this).val())});let M=k.filter(v=>e.includes(v.properties.destinoDesc)).filter(v=>t.includes(v.properties.sublinea));J(M,15)};function J(e,t){new Promise(function(c){window.mapita.removeLayer(S),S=A.featureGroup(),c()}).then(()=>{e.forEach(c=>{if(we(c.geometry.coordinates)){let M=null;D&&(M="disabled");const v=A.marker(c.geometry.coordinates,{icon:pe});v.bindPopup(`<div style="display: flex; justify-content: space-between;"> <p class="mb-0 mt-0 fs-6 fw-bold"><b>${c.properties.linea} </b> </p>       <button class= "mt-0 mb-0 btn btn-outline-primary btn-sm fw-bold seguiBus" ${M}>Seguí tu bondi</button> </div>
                </br>Destino: ${c.properties.destinoDesc} </br>
                 Tipo: ${c.properties.sublinea}`).on("click",Ie),Ue.push(v),v.addTo(S),c.marker_id=S.getLayerId(v)}else console.log("Un bondi estaba fuera de uruguay")}),S.addTo(window.mapita),z=null,z=S.getBounds(),e.length>1&&window.mapita.fitBounds(z),e.length==1&&window.mapita.setView(e[0].geometry.coordinates,t)})}const we=e=>{const t=[[-57.0416736,-33.9114244],[-57.0636507,-35.1291316],[-54.9703315,-35.2009977],[-55.01978,-33.9843498]];for(var c=e[1],M=e[0],v=!1,b=0,w=t.length-1;b<t.length;w=b++){var I=t[b][0],V=t[b][1],W=t[w][0],se=t[w][1],Ee=V>M!=se>M&&c<(W-I)*(M-V)/(se-V)+I;Ee&&(v=!v)}return v};n("#empresa").change(function(){T=!0,n("#search").html("Buscar"),H();var e=n("#empresa").val();n(".segundo").removeAttr("disabled"),n("#linea").empty(),O[e].forEach(t=>{n("#linea").append(`<option value=${t}>  ${t} </option>`)})}),n("#linea").change(()=>{T=!0,n("#search").html("Buscar"),H()});const Ie=e=>{K=null,console.log(S.getLayerId(e.target)),K=k.filter(t=>t.marker_id==S.getLayerId(e.target)),e.target},re=e=>{e?(Date.now()-e.lastUpdateDB>=2e4&&p(),k=e.data,k.forEach(t=>{t.geometry.coordinates.reverse()}),J(k,window.mapita.getZoom())):(J(K,15),D=setInterval(()=>{ye(K[0].properties.id)},7e3)),n("#alert_follow").empty().append('<div style="display: flex; justify-content: space-between;" class="alert alert-info fade show" role="alert"><p class="align-self-center mb-0 mt-0">Estás siguiendo a tu bondi (actualización automática).</p><button type="button" class="btn btn btn-outline-danger align-self-right" id="closeBtnFollow">Dejar de seguir</button> </div>'),n("#closeBtnFollow").click(()=>{n("#alert_follow").empty(),clearInterval(D),D=null,B(n("#empresa").val(),n("#linea").val())})};n(document).on("click",".seguiBus",function(e){D||re()});const ye=e=>{n.ajax({url:`${G}/getBusbyID?ID=${e}`,method:"get",contentType:"application/json",success:t=>{re(t)}})},oe=()=>{n("#fav_lines").empty(),E.length>0&&(n("#fav_lines_box").removeClass("d-none"),E.forEach(e=>{n("#fav_lines").append(` 
                    <button type="button" class="btn btn-primary btn-sm " id="button_line_${e}" value=${e}>
                    ${e}
                    <span aria-hidden="true" class="close" data-dismiss="alert" id="span_${e}">&times;</span>
                </button>`),n(`#span_${e}`).on("click",t=>{t.currentTarget.parentElement.remove(),be(e),E.length==0&&n("#fav_lines_box").addClass("d-none")}),n(`#button_line_${e}`).on("click",t=>{T=!0;let c=null;for(let M in O)O[M].indexOf(t.currentTarget.value)!==-1&&(c=M);console.log(c,t.currentTarget.value),B(c,t.currentTarget.value),te(t.currentTarget.value,c)})}))};let ae=window.localStorage.getItem("favedLines"),E=null;ae===null?E=[]:(E=JSON.parse(ae),oe());const be=e=>{const t=E.indexOf(e);t>-1&&E.splice(t,1),window.localStorage.setItem("favedLines",JSON.stringify(E))},Ve=()=>{let e=n("#linea").val();E.includes(e)||(E.push(e),window.localStorage.setItem("favedLines",JSON.stringify(E))),oe()};n("#add_fav").on("click",Ve);let x=window.localStorage.getItem("showModalVersion");const ie=new Ae(n("#modal_whats_new"));console.log(x,JSON.parse(x)),(x==null||JSON.parse(x)!="0.0.9")&&ie.show(),n("#close_modal_new").on("click",()=>{ie.hide(),window.localStorage.setItem("showModalVersion",JSON.stringify("0.0.9"))});let Q=[{codigo:"13",descripcion:"CASANOVA LIMITADA"},{codigo:"29",descripcion:"C.I.T.A."},{codigo:"10",descripcion:"C.O.E.T.C."},{codigo:"33",descripcion:"C.O. DEL ESTE"},{codigo:"20",descripcion:"C.O.M.E.S.A"},{codigo:"18",descripcion:"C.O.P.S.A."},{codigo:"50",descripcion:"C.U.T.C.S.A."},{codigo:"32",descripcion:"SATT"},{codigo:"35",descripcion:"TALA-PANDO-MONTEVIDEO"},{codigo:"70",descripcion:"U.C.O.T."},{codigo:"39",descripcion:"ZEBALLOS HERMANOS"},{codigo:"41",descripcion:"RUTAS DEL NORTE"}];for(let e in Q)n("#empresa").append("<option value="+Q[e].codigo+">"+Q[e].descripcion+"</option>")});
