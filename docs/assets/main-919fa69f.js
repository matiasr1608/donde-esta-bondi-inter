import{$ as r}from"./for_all-9d723cd2.js";import{l as b}from"./L.Control.Locate-4cc06a5c.js";const le="data:image/png;base64,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fFvbqMe3V6lP/wULofNwWi7YuXZNUKHIK+SF9MbyisOeTl3Zv650wP19vG8vMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMVgIMURvF5dXHJZgMs7+daU97j+XEGKwEGKwEGKwEGKwEGKwEGKwEGKwEGKwEGL8H6PEFvcfQRp6AAAAAElFTkSuQmCC",ce=""+new URL("BusIcon-8a605cbb.png",import.meta.url).href;try{self["workbox:window:6.5.3"]&&_()}catch{}function F(n,s){return new Promise(function(o){var g=new MessageChannel;g.port1.onmessage=function(d){o(d.data)},n.postMessage(s,[g.port2])})}function ge(n,s){for(var o=0;o<s.length;o++){var g=s[o];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}function Y(n,s){(s==null||s>n.length)&&(s=n.length);for(var o=0,g=new Array(s);o<s;o++)g[o]=n[o];return g}function de(n,s){var o;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(o=function(d,m){if(d){if(typeof d=="string")return Y(d,m);var h=Object.prototype.toString.call(d).slice(8,-1);return h==="Object"&&d.constructor&&(h=d.constructor.name),h==="Map"||h==="Set"?Array.from(d):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?Y(d,m):void 0}}(n))||s&&n&&typeof n.length=="number"){o&&(n=o);var g=0;return function(){return g>=n.length?{done:!0}:{done:!1,value:n[g++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(o=n[Symbol.iterator]()).next.bind(o)}try{self["workbox:core:6.5.3"]&&_()}catch{}var q=function(){var n=this;this.promise=new Promise(function(s,o){n.resolve=s,n.reject=o})};function N(n,s){var o=location.href;return new URL(n,o).href===new URL(s,o).href}var C=function(n,s){this.type=n,Object.assign(this,s)};function O(n,s,o){return o?s?s(n):n:(n&&n.then||(n=Promise.resolve(n)),s?n.then(s):n)}function ue(){}var pe={type:"SKIP_WAITING"};function z(n,s){if(!s)return n&&n.then?n.then(ue):Promise.resolve()}var fe=function(n){var s,o;function g(p,f){var t,i;return f===void 0&&(f={}),(t=n.call(this)||this).nn={},t.tn=0,t.rn=new q,t.en=new q,t.on=new q,t.un=0,t.an=new Set,t.cn=function(){var l=t.fn,c=l.installing;t.tn>0||!N(c.scriptURL,t.sn.toString())||performance.now()>t.un+6e4?(t.vn=c,l.removeEventListener("updatefound",t.cn)):(t.hn=c,t.an.add(c),t.rn.resolve(c)),++t.tn,c.addEventListener("statechange",t.ln)},t.ln=function(l){var c=t.fn,M=l.target,A=M.state,P=M===t.vn,k={sw:M,isExternal:P,originalEvent:l};!P&&t.mn&&(k.isUpdate=!0),t.dispatchEvent(new C(A,k)),A==="installed"?t.wn=self.setTimeout(function(){A==="installed"&&c.waiting===M&&t.dispatchEvent(new C("waiting",k))},200):A==="activating"&&(clearTimeout(t.wn),P||t.en.resolve(M))},t.dn=function(l){var c=t.hn,M=c!==navigator.serviceWorker.controller;t.dispatchEvent(new C("controlling",{isExternal:M,originalEvent:l,sw:c,isUpdate:t.mn})),M||t.on.resolve(c)},t.gn=(i=function(l){var c=l.data,M=l.ports,A=l.source;return O(t.getSW(),function(){t.an.has(A)&&t.dispatchEvent(new C("message",{data:c,originalEvent:l,ports:M,sw:A}))})},function(){for(var l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];try{return Promise.resolve(i.apply(this,l))}catch(M){return Promise.reject(M)}}),t.sn=p,t.nn=f,navigator.serviceWorker.addEventListener("message",t.gn),t}o=n,(s=g).prototype=Object.create(o.prototype),s.prototype.constructor=s,s.__proto__=o;var d,m,h=g.prototype;return h.register=function(p){var f=(p===void 0?{}:p).immediate,t=f!==void 0&&f;try{var i=this;return function(l,c){var M=l();return M&&M.then?M.then(c):c(M)}(function(){if(!t&&document.readyState!=="complete")return z(new Promise(function(l){return window.addEventListener("load",l)}))},function(){return i.mn=Boolean(navigator.serviceWorker.controller),i.yn=i.pn(),O(i.bn(),function(l){i.fn=l,i.yn&&(i.hn=i.yn,i.en.resolve(i.yn),i.on.resolve(i.yn),i.yn.addEventListener("statechange",i.ln,{once:!0}));var c=i.fn.waiting;return c&&N(c.scriptURL,i.sn.toString())&&(i.hn=c,Promise.resolve().then(function(){i.dispatchEvent(new C("waiting",{sw:c,wasWaitingBeforeRegister:!0}))}).then(function(){})),i.hn&&(i.rn.resolve(i.hn),i.an.add(i.hn)),i.fn.addEventListener("updatefound",i.cn),navigator.serviceWorker.addEventListener("controllerchange",i.dn),i.fn})})}catch(l){return Promise.reject(l)}},h.update=function(){try{return this.fn?z(this.fn.update()):void 0}catch(p){return Promise.reject(p)}},h.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},h.messageSW=function(p){try{return O(this.getSW(),function(f){return F(f,p)})}catch(f){return Promise.reject(f)}},h.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&F(this.fn.waiting,pe)},h.pn=function(){var p=navigator.serviceWorker.controller;return p&&N(p.scriptURL,this.sn.toString())?p:void 0},h.bn=function(){try{var p=this;return function(f,t){try{var i=f()}catch(l){return t(l)}return i&&i.then?i.then(void 0,t):i}(function(){return O(navigator.serviceWorker.register(p.sn,p.nn),function(f){return p.un=performance.now(),f})},function(f){throw f})}catch(f){return Promise.reject(f)}},d=g,(m=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&ge(d.prototype,m),g}(function(){function n(){this.Pn=new Map}var s=n.prototype;return s.addEventListener=function(o,g){this.Sn(o).add(g)},s.removeEventListener=function(o,g){this.Sn(o).delete(g)},s.dispatchEvent=function(o){o.target=this;for(var g,d=de(this.Sn(o.type));!(g=d()).done;)(0,g.value)(o)},s.Sn=function(o){return this.Pn.has(o)||this.Pn.set(o,new Set),this.Pn.get(o)},n}());const he=Object.freeze(Object.defineProperty({__proto__:null,Workbox:fe,WorkboxEvent:C,messageSW:F},Symbol.toStringTag,{value:"Module"})),me="modulepreload",Me=function(n,s){return new URL(n,s).href},$={},ve=function(s,o,g){if(!o||o.length===0)return s();const d=document.getElementsByTagName("link");return Promise.all(o.map(m=>{if(m=Me(m,g),m in $)return;$[m]=!0;const h=m.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(!!g)for(let i=d.length-1;i>=0;i--){const l=d[i];if(l.href===m&&(!h||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${p}`))return;const t=document.createElement("link");if(t.rel=h?"stylesheet":me,h||(t.as="script",t.crossOrigin=""),t.href=m,document.head.appendChild(t),h)return new Promise((i,l)=>{t.addEventListener("load",i),t.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>s())};function Ie(n={}){const{immediate:s=!1,onNeedRefresh:o,onOfflineReady:g,onRegistered:d,onRegisteredSW:m,onRegisterError:h}=n;let p,f;const t=async(l=!0)=>{await f};async function i(){if("serviceWorker"in navigator){const{Workbox:l}=await ve(()=>Promise.resolve().then(()=>he),void 0,import.meta.url);p=new l("./sw.js",{scope:"/",type:"classic"}),p.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),p.addEventListener("installed",c=>{c.isUpdate||g==null||g()}),p.register({immediate:s}).then(c=>{m?m("./sw.js",c):d==null||d(c)}).catch(c=>{h==null||h(c)})}}return f=i(),t}const R="https://backend.matiasrolando.com";var H={10:["2","D222","222","402","404","405","407","409","427","456","494","4A","4AC","4AD","4D","48D","4DR","5D","600","76","CE1","D9","G","L14","L16","L29","L7"],13:["15A","15B","6A","6R6"],18:["1A","2A","700","701","702","702R","703","704","705","706","707","708","709","710","711","712","714","724","747","748","750","751","752","757","7A","7E7R","7E8R","7E8D","7H","802","803","804","805","806","807","808","809","888","8A","8E7R","8E8R","DM1","P757","P758","P759","P760","P761","P768","P7H","XA1","XA2"],20:["1M11","1M1","1M2","1M3","1M4","1M5","1M6","1M7","1M12","1M13","1M14","1M15","1M16","1M6","1M7","2M1","2M7","2M8","505","522","524","526","538","546","582","D11","L24","L25","L38","MD3","ML1"],29:["2K"],32:["S5","S6","S7"],33:["A1","A10","A11","A12","A14","A16","A18","A5","A6","A9"],35:["10A","14A","14AB","14AR","T1","T14A","T2","T4N","T4R","T5","T6"],36:[],37:[],39:["Z1","Z2","Z3","Z4"],50:["100","102","103","104","105","109","110","111","112","113","115","116","117","121","124","125","127","128","130","137","141","142","143","144","145","147","148","149","150","151","155","156","157","158","163","169","174","175","180","181","183","185","186","187","188","191","192","195","199","21","214","227","230","230D","268","276","60","62","64","C1","C2","C3","C4","C5","CE1","D10","D5","D8","DE1","DM1","E14","G10","G11","G3","G8","L1","L15","L2","L20","L22","L26","L28","L3","L35","L36","L39","L4","L41","L46","L5","L6","L9"],70:["6B","11A","17","221","300","306","316","328","329","330","370","396","71","79","CE1","DM1","L12","L31","L33","U11C","XA1"],80:[]},E=null,S=null,W=null,we=new Array,X=null,T=!0;let U=null;var G=null,B=null;let x=[];Ie({reloadOnUpdate:!0,immediate:!0});r(document).ready(function(){setTimeout(()=>{console.log("enrtró"),navigator.serviceWorker.getRegistration().then(function(e){e.waiting&&confirm("Actualización disponible, ¿Desea actualizar la página?")&&e.waiting.postMessage({type:"SKIP_WAITING"})}),navigator.serviceWorker.addEventListener("controllerchange",function(){window.location.reload()})},1e4);var n=null;window.addEventListener("beforeinstallprompt",s,o);function s(e){n=e,document.getElementById("pwa_btn").removeAttribute("disabled")}function o(e){console.log("error: "+e)}r("#pwa_btn").click(()=>{n&&n.prompt()}),setTimeout(()=>{n||(document.getElementById("pwa_btn").removeAttribute("disabled"),r("#pwa_btn").attr("data-bs-toggle","modal"),r("#pwa_btn").attr("data-bs-target","#exampleModal"))},1e3),window.mapita=b.map("map").setView([-34.814733,-56.180452],9).on("moveend",e=>{ee()}),b.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(window.mapita),b.control.locate({position:"topright",strings:{title:"Ubicarme."}}).addTo(window.mapita),S=b.featureGroup().addTo(window.mapita);function g(){r.ajax({url:`${R}/updateDB`,method:"get",contentType:"application/json",success:function(e){console.log(e)}})}g();const d=100,m=e=>Math.ceil(e*d)/d,h=e=>Math.floor(e*d)/d,p=(e,a)=>{const u=h(e),V=m(a),I=[];for(let y=u;y<=V;y+=1/d)I.push(y);return I};let f=0,t=new Map;const i=window.localStorage.getItem("tileMap2");let l=null;i===null?l=new Map:l=new Map(JSON.parse(i));const c=e=>{f+=1;let a=f;const u=p(e._southWest.lat,e._northEast.lat),V=p(e._southWest.lng,e._northEast.lng);let I=new Array;for(const w of u)for(const v of V)I.push({lat:w,long:v});t.size>0&&t.forEach((w,v)=>{if(!I.some(L=>JSON.stringify(L)===v)){//!arrayTilesSeen.some(obj => JSON.stringify(obj) === JSON.stringify(key))
k(w),t.delete(v)}});let y=new Array;I.forEach(w=>{if(!t.has(JSON.stringify(w))){let v=P(w).then(L=>{if(a!=f)throw"se resolvió tarde";if(Array.isArray(L)){let Z=M(L);return t.set(JSON.stringify(w),Z),{tile:w,data:L}}else return t.set(JSON.stringify(w),[]),{tile:w,data:[]}});y.push(v)}}),Promise.allSettled(y).then(w=>{w.forEach(v=>{v.status=="fulfilled"&&l.set(JSON.stringify(v.value.tile),v.value.data)}),localStorage.setItem("tileMap2",JSON.stringify(Array.from(l.entries())))})},M=e=>{if(Array.isArray(e))return W=b.layerGroup(),e.forEach(a=>{const u=b.marker(a.geometry.coordinates,{icon:te});var V=r("<div>",{class:"overflow-auto",style:"max-height: 15rem; max-width: 10rem"});V.append('<p class="mb-0 mt-0 fs-6 fw-bold">Seleccioná la linea a buscar:  </p> </br> ');var I=r("<div>");a.properties.lineas.split("-").forEach(y=>{var w=r("<button>",{id:"button"+y,type:"button",class:"btn btn-outline-primary btn-sm",style:"width:4rem"}).on("click",v=>{A(v)}).append(y);I.append(w)}),V.append(I),u.bindPopup(V[0]),u.addTo(W)}),W.addTo(window.mapita),W._leaflet_id},A=e=>{T=!0;let a=null;for(let u in H)H[u].indexOf(e.currentTarget.innerText)!==-1&&(a=u);D(a,e.currentTarget.innerText),console.log(a),r("#empresa").val(a),r(".segundo").removeAttr("disabled"),r("#linea").empty(),r("#linea").append("<option value="+e.currentTarget.innerText+">"+e.currentTarget.innerText+"</option>")},P=async e=>{if(l.has(JSON.stringify(e))){let a=l.get(JSON.stringify(e));return new Promise(u=>{u(a)})}else{let a=[e.long+1/d,e.lat],u=[e.long,e.lat+1/d],V=String(a).replace(/\[|\]/g,""),I=String(u).replace(/\[|\]/g,"");return new Promise(y=>{r.ajax({url:`${R}/getStops?btmLeft=`+V+"&upperRight="+I,method:"get",contentType:"application/json",success:w=>{var v=w.data;Array.isArray(v)&&v.forEach(L=>{L.geometry.coordinates=L.geometry.coordinates.reverse()}),l.set(JSON.stringify(e),v),y(v)}})})}},k=e=>{var a=window.mapita._layers[e];a&&window.mapita.removeLayer(a)},ee=()=>{window.mapita.getZoom()>=15?c(window.mapita.getBounds()):t.forEach((e,a)=>{k(e),t.delete(a)})};var te=b.icon({iconUrl:le,iconSize:[15,39],iconAnchor:[7,39],popupAnchor:[0,-39]}),ne=b.icon({iconUrl:ce,iconSize:[25,55],iconAnchor:[12.5,55],popupAnchor:[0,-39]});r("#search").click(async()=>{T?D(r("#empresa").val(),r("#linea").val()):U||(D(r("#empresa").val(),r("#linea").val()),U=setTimeout(()=>{clearTimeout(U),U=null},2e3))});const D=(e,a)=>{r.ajax({url:`${R}/buses?codigoEmpresa=`+e+"&linea="+a,method:"get",contentType:"application/json",success:u=>{re(u),console.log(u)}})};function re(e){r("#search").html("Actualizar"),E=e.data,E.forEach(a=>{a.geometry.coordinates.reverse()}),e.lastUpdateDB,E.length>0?(x=new Array,E.forEach(a=>{x.indexOf(a.properties.destinoDesc)===-1&&x.push(a.properties.destinoDesc)}),T&&oe(),new Promise(function(a){Q(),a()}),r("#alert_tiempo").empty(),Date.now()-e.lastUpdateDB>=2e4&&(r("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">Las ubicaciones no están actualizadas, intente actualizar nuevamente en unos segundos. (diferencia '+(Date.now()-e.lastUpdateDB)/1e3+'segundos)<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),console.log("mas de 20 seg"),g(),r("#search").addClass("disabled"),r("#search").html("Espere"),setTimeout(function(){r("#search").removeClass("disabled"),r("#search").html("Actualizar")},5e3)),r(".tercero").removeAttr("hidden"),r("#select_company")[0].scrollIntoView()):r("#alert_tiempo").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">No hay ubicaciones reportadas para su búsqueda, intente nuevamente.<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> </div>'),T=!1}function oe(){let e=0;r("#switch_destinations").empty(),x.forEach(a=>{e+=1,ie(a,Q,e)})}const ie=(e,a,u)=>{r("#switch_destinations").append(`<div class= "form-check form-switch">
                <input class="form-check-input" type="checkbox" name="prueba" role="switch" value="${e}" id="flexSwitchCheck${u}" checked>
                <label class="form-check-label" for="flexSwitchCheck${e}">${e}</label>
            </div>`),r(`#flexSwitchCheck${u}`).click(()=>a())},Q=()=>{var e=new Array;r(".form-check-input:checked").each(function(){e.push(r(this).val())});let a=E.filter(u=>e.includes(u.properties.destinoDesc));j(a,15)};function j(e,a){new Promise(function(u){window.mapita.removeLayer(S),S=b.featureGroup(),u()}).then(()=>{e.forEach(u=>{let V=null;B&&(V="disabled");const I=b.marker(u.geometry.coordinates,{icon:ne});I.bindPopup(`<div style="display: flex; justify-content: space-between;"> <p class="mb-0 mt-0 fs-6 fw-bold"><b>${u.properties.linea} </b> </p>       <button class= "mt-0 mb-0 btn btn-outline-primary btn-sm fw-bold seguiBus" ${V}>Seguí tu bondi</button> </div>
                </br>Destino: ${u.properties.destinoDesc} </br>
                 Tipo: ${u.properties.sublinea}`).on("click",ae),we.push(I),I.addTo(S),u.marker_id=S.getLayerId(I)}),S.addTo(window.mapita),X=null,X=S.getBounds(),e.length>1&&window.mapita.fitBounds(X),e.length==1&&window.mapita.setView(e[0].geometry.coordinates,a)})}r("#empresa").change(function(){T=!0;var e=r("#empresa").val();r(".segundo").removeAttr("disabled"),r("#linea").empty(),H[e].forEach(a=>{r("#linea").append("<option value="+a+">"+a+"</option>")})}),r("#linea").change(()=>{T=!0});const ae=e=>{G=null,console.log(S.getLayerId(e.target)),G=E.filter(a=>a.marker_id==S.getLayerId(e.target)),e.target},J=e=>{e?(Date.now()-e.lastUpdateDB>=2e4&&g(),E=e.data,E.forEach(a=>{a.geometry.coordinates.reverse()}),j(E,window.mapita.getZoom())):(j(G,15),B=setInterval(()=>{se(G[0].properties.id)},7e3)),r("#alert_follow").empty().append('<div style="display: flex; justify-content: space-between;" class="alert alert-info fade show" role="alert"><p class="align-self-center mb-0 mt-0">Estás siguiendo a tu bondi (actualización automática).</p><button type="button" class="btn btn btn-outline-danger align-self-right" id="closeBtnFollow">Dejar de seguir</button> </div>'),r("#closeBtnFollow").click(()=>{r("#alert_follow").empty(),clearInterval(B),B=null,D(r("#empresa").val(),r("#linea").val())})};r(document).on("click",".seguiBus",function(e){B||J()});const se=e=>{r.ajax({url:`${R}/getBusbyID?ID=${e}`,method:"get",contentType:"application/json",success:a=>{J(a)}})};let K=[{codigo:"13",descripcion:"CASANOVA LIMITADA"},{codigo:"29",descripcion:"C.I.T.A."},{codigo:"10",descripcion:"C.O.E.T.C."},{codigo:"33",descripcion:"C.O. DEL ESTE"},{codigo:"20",descripcion:"C.O.M.E.S.A"},{codigo:"18",descripcion:"C.O.P.S.A."},{codigo:"50",descripcion:"C.U.T.C.S.A."},{codigo:"32",descripcion:"SATT"},{codigo:"35",descripcion:"TALA-PANDO-MONTEVIDEO"},{codigo:"70",descripcion:"U.C.O.T."},{codigo:"39",descripcion:"ZEBALLOS HERMANOS"}];for(let e in K)r("#empresa").append("<option value="+K[e].codigo+">"+K[e].descripcion+"</option>")});
